<% if events
     data_events = events.map do |event|
       [event.event,
        event.actions.map do |action|
          additional_options = case action.type.to_s
                                when 'replaces' then
                                  {grid_nesting:@grid_nesting, __parent_id__: parent_id}
                                when 'update', 'post', 'delete', 'autocomplete' then
                                  {__parent_id__: parent_id}
                                else
                                  {}
                              end
          [action.type, action.url, action.options.to_h.merge(additional_options), action.params.to_h]
        end,
       {once: false}]
     end %>
  data-events = '<%= data_events.to_json %>'
<% end %>
